# 당신만의 맞춤화된 글로벌 뉴스 Moya 

1. 서비스 소개
2. 폴더 구조
3. 문제 해결 
4. 기능 GIF
5. 기타 

시스메틱측의 보안 문제로 6월 3일(금)요일까지만 API가 제공됩니다. 때문에 이후부터는 코드 공개는 가능하나 기능이 작동하지 않습니다!

## 0. 실행 방법

```
npm start
```

## **1. 서비스 소개**

- 주 서비스는 주식투자자들을 위한 해외 뉴스 검색 서비스입니다. 20000여개의 주식 관련된 키워드를 제공 해 투자 관련 뉴스를 제공합니다.
- 북마크를 통해 기사를 저장하고 자동 언어 번역기능을 제공해 세계의 투자자들을 위한 뉴스를 구독할 수 있습니다.


## 2. 폴더 구조

### 관심사의 분리(Separation of Concerns)

하나의 화면(page)에 비즈니스 로직, 데이터, 컴포넌트를 모두 관리하는 것이 아니라 pages, features, components로 나누어 화면을 관리하였습니다.

**👏왜 관심사를 분리 했나요?**

협업과 유지보수에 유리합니다. 기존 프로젝트는 component에 UI와 기능이 섞여 있어 기능 사용 시 관련 없는 폴더 및 코드가 존재 해 코드 파악이 어려웠습니다. 때문에 이해를 위해 동료들이나 백엔드 개발자님과의 커뮤니케이션 비용이 많이 발생했습니다. 

하지만 관심사를 분리하면 코드 파악이 쉬워집니다. UI코드와 기능 코드 단위로 분리돼 개발자 입장에서도 필요한 목적 즉 코드를 찾기가 쉬워집니다. 이런 점 덕분에 유지보수 속도가 개선되고 커뮤니케이션 비용을 줄일 수 있었습니다.
덕분에 수정사항이 필요할 때 수정이 매우 용이해졌고 작업속도가 향상되었습니다.

#### 디렉토리 구조

![](https://velog.velcdn.com/images/gn753/post/2163c04c-8a2c-4b8e-b510-1eadbe9bfce3/image.jpg)


**features**

- 재사용이 가능한 기능 단위 요소의 컴포넌트로 구성되어 있습니다.
- 기능 내에서 사용하는 Hook과 types를 구성 해 관리하기가 용이합니다.

**Pages**

- 로컬 단위의 기능과 UI에 집중합니다.

**layout**

- 공통 레이아웃인 Header, footer로 구성되어 있습니다.


## 3. 문제 해결과 기여했던 점

<details>
 <summary><h3>1. 페이지 이동 지연과 함수 단일한 기능으로 쪼개 개선</h3></summary>
<div markdown="1">


메인 페이지(Home)에 있는 검색 폼에서 뉴스를 검색 하면 뉴스 페이지로 이동이 2초 정도 지연돠는 현상이 발생했던 문제를 검색 요청 시 즉시 이동하도록 개선했습니다.  

지연의 원인이 무엇일까 궁금해 끈질기게 코드를 파악 했습니다. 결과 주소 표시줄의 URL이 2초정도 변동이 없다는 점과 데이터 응답이 성공할 경우만 페이지가 이동하도록 설계 된 것이 원인<이었습니다. 당연히 데이터 요청은 서버에서 받아오는 작업이므로 시간이 걸리기 때문에 느릴 수 밖에 없었습니다. 

저는 이 문제를 함수를 세분화 하고 역할을 바꿔 문제를 개선했습니다. 검색 폼에서는 useGotoNewsPage라는 커스텀 훅을 만들어 URL 쿼리문으로 페이지 이동만을 해주는 역할을 담당합니다. 키워드에 대한 실제 서버에 검색 요청은 뉴스를 보여주는 페이지 NewsPage에서 하도록 햇습니다. 결과 함수의 역할이 세분화되었기 때문에 재사용성이 증가했고 기능 단위로 파악이 쉬워져 수정이 용이해졌습니다.

</div>
</details>

<details>
 <summary><h3>2.이전 검색 값이 초기화 되지 않던 문제 개선..</h3></summary>
<div markdown="1">

검색 폼에서 뉴스 검색 후 새로운 키워드나 필터링으로 다시 검색 시 이전 뉴스 기사들이 남아 함께 렌더링 되던 문제가 있었습니다. 

원인은 뉴스 데이터를 담은 저장소가 지역이 아닌 전역이었다는 점입니다. 때문에 다음 페이지를 요구하는 경우가 아닌 경우에는 이를 매번 초기화 해야했습니다. 

또한 초기화를 위해서 nextPageToken을 제외한 검색에 필요한 나머지 파라미터를 감지 하는 상태 관리가 필요했습니다. 

React-Query를 도입해서 QueryKey라는 기능으로 검색 파라미터를 관리 해 이전 뉴스 기사들이 보이는 것을 해결했습니다. 이는 React-Query가 Key를 기반으로 요청을 관리하고 캐싱 데이터에 접근하기 때문입니다.

**🤦‍♀️Redux를 사용하지 않은 이유**

- Redux로 새 데이터를 보이게 구현한다면 검색 시 매번 데이터를 리셋하는 방법이 있습니다.
1. 다만 매번 리셋한다면 모야의 서비스를 고려할 때 검색했던 불필요하게 API를 반복 요청한다 느꼈습니다.
2. 검색 뉴스 플랫폼이며 탭을 추가 해 여러 뉴스를 반복적으로 볼 수 있는 서비스라는 점을 고려한다면 **캐싱을 활용해 API 호출을 최소화하는 React-Query가 더 적합하다 생각했습니다.**

</div>
</details>

<details>
 <summary><h3>3. 의존성이 있어 재사용이 어렵고 도메인 맥락을 읽기가 어려웠던 코드 개선.</h3></summary>
<div markdown="1">
<img src="https://velog.velcdn.com/images/gn753/post/81c2e313-df9c-47a9-bb78-aaa097cc38be/image.jpg" height="600px" width="100%">

복수의 기능이 있고 여러 컴포넌트에 의존성이 있는 코드를 단일한 기능 및 네이밍 맥락에 맞게 개선했습니다.  
프로젝트 회고 후 네이밍과 그 안의 코드의 일관성의 중요성을 느꼈습니다. Home Container 컴포넌트안에 Search 컴포넌트의 비즈니스 로직이 존재 해 Search와 keyword 양 컴포넌트가 HomeContaner 컴포넌트에 의존성이 생겼습니다. 

Home안에 분명 검색바 컴포넌트가 존재하는 것은 맞지만 Home에 묶여 있기에 Search 컴포넌트의 재사용성의 문제와 Home과 Search 컴포넌트에 헷갈리는 경우도 존재했습니다. 
Search와 관련된 코드들만 분리 해 코드 맥락을 개선해서 유지보수가 용이해졌고 재사용성이 개선되었습니다.

[문제]

- Container 컴포넌트안에 Search와 Keyword가 섞여 있어 둘의 컴포넌트 재사용이 어려운 점.
- useSearch hook과 IntroUI 등 여러 기능을 가진 코드가 뒤섞여 맥락을 파악하기 어려움.
- Serach와 관련 없는 UI 컴포넌트의 의존성이 원인.

[개선]

- 가장 신경을 쓴 건 코드의 맥락을 단일한 흐름으로 설계해 읽기 좋은 코드로 만드는 것이었습니다.
- Search와 관련된 코드들만 분리 해 코드 맥락을 개선해서 유지보수가 용이해졌고 재사용성이 개선되었습니다.

</div>
</details>




## 4. 주요 기능 GIF ** 
 

### Style-Guide
![스타일가이드](https://user-images.githubusercontent.com/71584114/170329399-73d2279b-3b5b-4f15-9716-b0b8313394dc.PNG)
- 일관된 스타일링을 위해 페이지 내에 마크업으로 공통 가이드 제작.

### 4.1 로그인 쿠키 받아오기**

![로그인](https://user-images.githubusercontent.com/71584114/169321283-439c35a7-64da-4bb6-9011-77f9a3c918ed.gif)


- 로그인: 서버로부터 키워드 리스트 제공 받기 위해 세션쿠키 필요.
- 아이디 : aa, 비밀번호:aa

### 4.2. 뉴스 키워드 리스트와 필터링 옵션 제공**

![키워드 및 옵션](https://user-images.githubusercontent.com/71584114/169321379-780dda8e-8c78-40df-9164-b698089a4bf5.gif)
![자동완성](https://user-images.githubusercontent.com/71584114/170327814-dc8a79a7-e030-4be3-8463-0c60ebb00fca.gif)


- 주식 투자자들의 관심을 가질만한 20000개 이상의 뉴스 키워드 제공.
- 총 8개의 키워드 대주제와 3개의 맞춤뉴스 카테고리 제공.(startup,tickers,index,fx,sections,cateogry 등)
- 뉴스 필터링 옵션은 총 4개를 제공.
- 단 언어 필터링은 현재 서버측에서 영어만 지원.
- 해당 키워드를 클릭하면 구독된 페이지로 이동.

### 4.3. 검색 결과 페이지 무한 스크롤링**
![무한스크롤 및 옵션](https://user-images.githubusercontent.com/71584114/169321552-c25b0534-4a4b-4807-89d1-686b22aff480.gif)

- 무한스크롤
- 언어 번역 기능
- 뉴스카드 포맷 교체

### 4.4. 검색된 뉴스 필터링 옵션 제공**
![정렬 필터](https://user-images.githubusercontent.com/71584114/169321590-626eec07-a123-4eb9-b6e0-fedfd564eccb.gif)

- 정렬 필터링.



## 기타 
### 기술 스택과 채택이유
##### [React-Query]

- 기존에는 Redux를 사용했으나 검색페이지 구현 문제.
- 검색페이지에서는 같은 Query와 EndPoint 요청이면 다음 페이지 아니라면 새 페이지 출력 목표.
- React-quey의 Query key 의존성 배열로 요청 구분 개선.
- 또한 리덕스에서 문제였던 무한스크롤 중복요청과 캐싱으로 최적화 개선.

#### [Recoil]

- 검색 폼의 Select 옵션 파라미터를 여러 컴포넌트에 동일한 상태로 전달하고자 목표.
- custom hook으로는 형제 컴포넌트에 데이터 전달이 어려워 전역상태로 단일한 값을 가지도록 개선.
- Redux에 비해 낮은 러닝커브와 코드 작성량.

기타 기술 스택

- webpack
- Typescript
- emotion, react-router, ui-material


#### 참고했던 자료

- **지역성의 원칙을 고려한 패키지 구조: 기능별로 나누기** [https://ahnheejong.name/articles/package-structure-with-the-principal-of-locality-in-mind/](https://ahnheejong.name/articles/package-structure-with-the-principal-of-locality-in-mind/)
- 토스 토스ㅣSLASH 21 - 실무에서 바로 쓰는 Frontend Clean Code [https://toss.im/slash-21/sessions/3-3](https://toss.im/slash-21/sessions/3-3)
